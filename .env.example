# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# Environment: development | staging | production | test
NODE_ENV=development

# Application name (used in logs, metrics, traces)
APP_NAME=referral-campaign-service

# HTTP server port
APP_PORT=3000

# API prefix (e.g., /api/v1)
APP_API_PREFIX=api

# Allowed CORS origins (comma-separated)
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# =============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# =============================================================================

# Database connection
DATABASE_TYPE=postgres
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=your_password_here
DATABASE_NAME=referral_campaign_db
DATABASE_TEST_NAME=referral_campaign_test_db

# Optional: Full database URL (overrides individual connection params)
# DATABASE_URL=postgresql://user:password@localhost:5432/referral_campaign_db

# Connection pool
DATABASE_MAX_CONNECTIONS=100

# SSL configuration
DATABASE_SSL_ENABLED=false
DATABASE_REJECT_UNAUTHORIZED=false

# ORM options (use with caution in production)
DATABASE_SYNCHRONIZE=false
DATABASE_LOGGING=false

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis standalone connection
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=campaign:

# Redis security
REDIS_TLS_ENABLED=false

# AWS ElastiCache IAM Authentication (requires TLS)
# When enabled, uses IAM roles instead of password authentication
# Tokens are automatically generated and refreshed every 10 minutes
# PRODUCTION: Set to true when using ElastiCache with IAM auth
# LOCAL: Set to false and use REDIS_PASSWORD instead
REDIS_IAM_AUTH_ENABLED=false
REDIS_IAM_AUTH_USERNAME=default

# Redis cluster (optional)
REDIS_CLUSTER_ENABLED=false
# REDIS_CLUSTER_NODES=host1:port1,host2:port2,host3:port3

# Redis connection settings
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000
REDIS_RETRY_DELAY_MS=50
REDIS_MAX_RETRY_DELAY_MS=2000

# Cache TTL settings (seconds)
REDIS_DEFAULT_TTL=3600
REDIS_LOCK_TTL=30000

# =============================================================================
# AUTHENTICATION & AUTHORIZATION
# =============================================================================

# JWT/JWKS configuration (Ory Kratos, Auth0, etc.)
AUTH_JWKS_URI=https://your-auth-provider.com/.well-known/jwks.json
AUTH_ISSUER=https://your-auth-provider.com
AUTH_AUDIENCE=referral-campaign-api

# JWT algorithms (comma-separated)
AUTH_ALGORITHMS=RS256

# JWT validation
AUTH_CLOCK_TOLERANCE=30

# JWKS cache
AUTH_CACHE_ENABLED=true
AUTH_CACHE_TTL=600

# Multi-tenancy
AUTH_TENANT_HEADER=x-tenant-id
AUTH_TENANT_CLAIM_PATH=tenantId

# =============================================================================
# AWS CONFIGURATION
# =============================================================================

# AWS region
AWS_REGION=eu-central-1

# AWS credentials
# PRODUCTION (on AWS): Leave empty - uses IAM roles attached to EC2/ECS/Lambda
# LOCAL DEVELOPMENT: Set your access keys for testing
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# LocalStack or custom endpoint (for local development)
# AWS_ENDPOINT=http://localhost:4566

# SQS Configuration - FIFO Queues
# All queues MUST be FIFO queues (ending with .fifo)
# Format per queue: https://sqs.{region}.amazonaws.com/{account-id}/{queue-name}.fifo
SQS_QUEUE_CAMPAIGN_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/campaign-events.fifo
SQS_QUEUE_REFERRAL_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/referral-events.fifo
SQS_QUEUE_REWARD_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/reward-events.fifo
SQS_QUEUE_USER_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/user-events.fifo
SQS_QUEUE_NOTIFICATION_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/notification-events.fifo
SQS_QUEUE_ANALYTICS_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/analytics-events.fifo
SQS_QUEUE_WORKFLOW_EVENTS=https://sqs.eu-central-1.amazonaws.com/123456789/workflow-events.fifo

# SQS Default settings
SQS_DEFAULT_BATCH_SIZE=10
SQS_DEFAULT_VISIBILITY_TIMEOUT=30
SQS_DEFAULT_WAIT_TIME_SECONDS=20
SQS_POLLING_ENABLED=true

# SNS Configuration
# Format: "topic-name|arn:aws:sns:region:account:topic-name,..."
SNS_TOPICS=campaign-notifications|arn:aws:sns:eu-central-1:123456789:campaign-notifications

# S3 Configuration
S3_BUCKET_NAME=campaign-assets
S3_PRESIGNED_URL_EXPIRY=3600
S3_UPLOAD_PART_SIZE=5242880
S3_MAX_CONCURRENT_UPLOADS=4

# =============================================================================
# HTTP CLIENT CONFIGURATION
# =============================================================================

# HTTP client timeouts and retries
HTTP_CLIENT_TIMEOUT=30000
HTTP_CLIENT_MAX_REDIRECTS=5
HTTP_CLIENT_RETRY_ATTEMPTS=3
HTTP_CLIENT_RETRY_DELAY=1000
HTTP_CLIENT_RETRY_MAX_DELAY=30000
HTTP_CLIENT_RETRY_EXPONENTIAL=true

# Internal service domains for JWT forwarding
# Comma-separated list of domain patterns (supports wildcards)
# Examples: *.svc.cluster.local,*.default.svc.cluster.local,internal-api.example.com
# For Kubernetes services, use patterns like: *.svc.cluster.local
# JWT tokens will be forwarded ONLY to these domains for security
HTTP_INTERNAL_SERVICE_DOMAINS=*.svc.cluster.local,*.default.svc.cluster.local

# Circuit Breaker configuration
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_TIMEOUT=10000
CIRCUIT_BREAKER_ERROR_THRESHOLD=50
CIRCUIT_BREAKER_RESET_TIMEOUT=30000
CIRCUIT_BREAKER_VOLUME_THRESHOLD=10
CIRCUIT_BREAKER_MAX_CACHE_SIZE=100

# =============================================================================
# OPENTELEMETRY & OBSERVABILITY (Grafana Cloud)
# =============================================================================

# Enable/disable tracing and metrics
OTEL_ENABLED=true

# Service identification
OTEL_SERVICE_NAME=referral-campaign-service
OTEL_SERVICE_VERSION=1.0.0
OTEL_SERVICE_NAMESPACE=production

# Grafana Cloud credentials
GRAFANA_CLOUD_USER=123456
GRAFANA_CLOUD_API_KEY=glc_eyJxxxxxxxxxxxxxxxxxx

# OTLP endpoints for Grafana Cloud
# Traces endpoint (Tempo)
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=https://otlp-gateway-prod-us-east-0.grafana.net/otlp/v1/traces

# Metrics endpoint (Prometheus/Mimir) - OPTIONAL
OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=https://otlp-gateway-prod-us-east-0.grafana.net/otlp/v1/metrics

# Metrics export interval (milliseconds)
OTEL_METRICS_EXPORT_INTERVAL=60000

# Trace propagation
OTEL_PROPAGATE_B3=true
OTEL_PROPAGATE_W3C=true

# Logging level for OTEL
OTEL_LOG_LEVEL=info

# Sampling (0.0 to 1.0, where 1.0 = 100% of traces)
OTEL_SAMPLING_RATIO=1

# Advanced OTLP settings
OTEL_MAX_EXPORT_BATCH_SIZE=512
OTEL_SCHEDULED_DELAY_MILLIS=5000
OTEL_EXPORT_TIMEOUT_MILLIS=30000

# =============================================================================
# LOKI LOG AGGREGATION (Grafana Loki)
# =============================================================================

# Enable/disable Loki log aggregation (disabled in development, uses console)
LOKI_ENABLED=false

# Loki endpoint (Grafana Cloud or self-hosted)
# Format: https://logs-prod-us-central1.grafana.net
LOKI_HOST=https://logs-prod-us-central1.grafana.net

# Basic auth for Grafana Cloud Loki (format: user:password or user:api_key)
# For Grafana Cloud: use your Instance ID as user and API token as password
LOKI_BASIC_AUTH=123456:glc_eyJxxxxxxxxxxxxxxxxxx

# Loki labels (JSON format) - used to organize logs in Grafana
# Example: {"job":"referral-campaign-service","environment":"production","region":"us-east-1"}
LOKI_LABELS={"job":"referral-campaign-service","environment":"production"}

# Loki batch interval (milliseconds) - how often to send logs to Loki
LOKI_BATCH_INTERVAL=5000

# =============================================================================
# BULLMQ QUEUE CONFIGURATION
# =============================================================================

# BullMQ uses the existing REDIS configuration above
# Queues are automatically prefixed with REDIS_KEY_PREFIX + 'bull:'
# Example: campaign:bull:email-queue

# Default job options (configured in code):
# - Retry attempts: 3
# - Backoff: exponential starting at 1 second
# - Keep completed jobs: last 100
# - Keep failed jobs: last 500 (for debugging)

# Worker configuration (configured in code):
# - Concurrency: 5 jobs per worker
# - Rate limiter: 10 jobs per second
# - Stalled check: every 30 seconds
# - Max stalled count: 2 before marking as failed

# =============================================================================
# TESTING
# =============================================================================

# Test database name (used when NODE_ENV=test)
DATABASE_TEST_NAME=referral_campaign_test_db
